"use strict";angular.module("antresolApp",["ngResource","ngRoute","ngSocial"]).config(["$routeProvider","$locationProvider","$resourceProvider",function(a,b,c){a.when("/Antresol/",{templateUrl:"views/list.html",controller:"AdsCtrl",controllerAs:"vm"}).when("/Antresol/ads",{templateUrl:"views/list.html",controller:"AdsCtrl",controllerAs:"vm"}).when("/Antresol/ads/:adId",{templateUrl:"views/item.html",controller:"AdsItemCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/Antresol/ads"}),window.history&&window.history.pushState&&b.html5Mode(!0)}]),angular.module("antresolApp").factory("AdsService",["$resource",function(a){var b=a("http://api.antresol.it/v1/ads",{},{getAdsList:{method:"GET",url:"http://api.antresol.it/v1/ads",isArray:!1},getAd:{method:"GET",url:"http://api.antresol.it/v1/ads/:adsId",isArray:!1}}),c=function(){this.busy=!1,this.page=1,this.items=[],this.item={},this.mainImgUrl=""};return c.prototype.nextPage=function(){this.busy||(this.busy=!0,b.getAdsList({page:this.page}).$promise.then(function(a){this.items=this.items.concat(a.data),this.page++,this.busy=!1}.bind(this)))},c.prototype.getAd=function(a){b.getAd({adsId:a}).$promise.then(function(a){this.item=a.data,this.mainImgUrl=a.data.images[0].url}.bind(this))},c}]),angular.module("antresolApp").directive("grid",function(){function a(a,b,c){a.$watch("gridData",function(b,d){if(void 0!=b&&0!=b.length){for(var e=0,f=0,g=b.length-20;g<b.length;g++)f=[a.gridColumns[0],a.gridColumns[1],a.gridColumns[2],a.gridColumns[3]].indexOf(Math.min(a.gridColumns[0],a.gridColumns[1],a.gridColumns[2],a.gridColumns[3])),e=250*f,b[g].top=a.gridColumns[f],b[g].left=e,a.gridColumns[f]=b[g].image.height/b[g].image.width*c.children()[0].offsetWidth+117+10+a.gridColumns[f];c.css("height",Math.max(a.gridColumns[0],a.gridColumns[1],a.gridColumns[2],a.gridColumns[3])+"px")}})}a.$inject=["$scope","$attrs","$element"];var b={restrict:"A",scope:{gridColumns:"=gridColumns",gridData:"=gridData"},controller:a};return b}),angular.module("antresolApp").directive("whenScrolled",["$window",function(a){return function(b,c,d){var e=(angular.element(a)[0].screenTop,angular.element(a)[0].screen.height),f=.9*e;angular.element(a).bind("scroll",function(){angular.element(a)[0].scrollY>=f&&angular.element(a)[0].requestAnimationFrame(function(){b.$apply(d.whenScrolled),f+=1.6*e})})}}]),angular.module("antresolApp").controller("AdsCtrl",["$scope","$timeout","AdsService",function(a,b,c){var d=this;d.gridColumns=[0,0,0,0],d.ads=new c}]),angular.module("antresolApp").controller("AdsItemCtrl",["AdsService","$routeParams","$window",function(a,b,c){function d(a){e.ads.mainImgUrl=a}var e=this;e.url=c.location.href,e.ads=new a,e.setImg=d,e.ads.getAd(b.adId)}]);
